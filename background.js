(()=>{const e={apiKey:"AIzaSyCtkDvbYbosr5ZhTh9g3VO1q7Fe45KvAqg",authDomain:"smash-karts-match-tracker.firebaseapp.com",projectId:"smash-karts-match-tracker",storageBucket:"smash-karts-match-tracker.firebasestorage.app",messagingSenderId:"324411303245",appId:"1:324411303245:web:caccc3059a3f929b7f0304"};let t=null;try{firebase.initializeApp(e),t=firebase.firestore()}catch(e){console.error("Error initializing Firebase:",e)}chrome.runtime.onMessage.addListener(((e,a,s)=>{if("matchComplete"===e.type)!async function(e){if(t)try{if(e.isSpecialMode){const a=t.collection("special_matches").doc();await a.set({...e,timestamp:firebase.firestore.FieldValue.serverTimestamp()})}else{const a=t.collection("matches").doc();await a.set({...e,timestamp:firebase.firestore.FieldValue.serverTimestamp()}),await async function(e){if(t)try{const a=t.collection("players").doc(e.skid),s=await a.get(),r=s.exists?s.data():{totalMatches:0,totalKills:0,totalDeaths:0,totalPowerUpsCollected:0,totalPowerUpsUsed:0,bestSmashStreak:0,specialModeMatches:0},o={totalMatches:r.totalMatches+1,totalKills:r.totalKills+e.kills,totalDeaths:r.totalDeaths+e.deaths,totalPowerUpsCollected:r.totalPowerUpsCollected+e.powerUpsCollected,totalPowerUpsUsed:r.totalPowerUpsUsed+e.powerUpsUsed,bestSmashStreak:Math.max(r.bestSmashStreak,Math.max(...e.smashStreaks.map((e=>e.type))))};await a.set(o,{merge:!0})}catch(e){console.error("Error updating player stats:",e)}}(e.playerStats)}}catch(e){console.error("Error storing match data:",e)}}(e.data);else if("OPEN_VISUALIZERS"===e.type){console.log("[SKMT] Opening visualizers page");try{const e=chrome.runtime.getURL("visualizers.html");return console.log("[SKMT] Visualizers URL:",e),chrome.tabs.create({url:e,active:!0},(e=>{chrome.runtime.lastError?(console.error("[SKMT] Error creating tab:",chrome.runtime.lastError),s({success:!1,error:chrome.runtime.lastError.message})):(console.log("[SKMT] Visualizers page opened successfully in tab:",e.id),s({success:!0,tabId:e.id}))})),!0}catch(e){return console.error("[SKMT] Error in OPEN_VISUALIZERS handler:",e),s({success:!1,error:e.message}),!1}}})),chrome.runtime.onInstalled.addListener((()=>{chrome.storage.local.set({settings:{enableTracking:!0,showNotifications:!0}})})),chrome.runtime.onUpdateAvailable.addListener((()=>{chrome.runtime.reload()}))})();