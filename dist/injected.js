console.log("[SKMT] Injected script running");const originalLog=console.log,originalInfo=console.info,originalWarn=console.warn,originalError=console.error;function setSkid(t){t&&"string"==typeof t&&t.length>5&&(window.kartStats.skid=t,console.log("[SKMT] SKID detected and set:",t),window.postMessage({type:"SKMT_SKID_UPDATED",skid:t},"*"))}function interceptConsole(t,e){return function(...t){if(t[0]&&"string"==typeof t[0]){const e=t[0].toLowerCase();if(e.includes("authstatechanged, uid:")){const e=t[0].match(/uid:\s*([^,\s]+)/i);e&&e[1]&&setSkid(e[1].trim())}if(e.includes("gamedataservice::getgamedatafromserverfirstload")){const e=t[0].trim().split(" ");setSkid(e[e.length-1].trim())}if((e.includes("bytebrew: sending custom event: play_special_mode")||e.includes("bytebrew: sending custom event: play_special_mode_rules")||e.includes("bytebrew: sending custom event: play_special_mode_arena"))&&(window.kartStats.isSpecialMode=!0),e.includes("bytebrew: sending custom event: confirmexitgame"),(e.includes("bytebrew: sending custom event: create_game_rules")||e.includes("bytebrew: sending custom event: create_game_weapons")||e.includes("bytebrew: sending custom event: create_game_level")||e.includes("bytebrew: sending custom event: create_game_mode")||e.includes("bytebrew: sending custom event: join_or_create_private_mode")||e.includes("bytebrew: sending custom event: join_or_create_private_arena"))&&(window.kartStats.isCustomMode=!0,window.kartStats.isSpecialMode=!1,console.log("[SKMT][CUSTOM] Custom event detected. isCustomMode set to true, isSpecialMode set to false.")),(e.includes("bytebrew: sending custom event: game_end")||e.includes("bytebrew: sending custom event: confirmexitgame"))&&window.kartStats.matchActive){const t=window.kartStats.isSpecialMode,a=window.kartStats.isCustomMode;window.kartStats.matchEndTime=Date.now(),e.includes("confirmexitgame")&&(window.kartStats.quit=!0,window.kartStats.isSpecialMode=!1);const i={kills:window.kartStats.kills,deaths:window.kartStats.deaths,matchStartTime:window.kartStats.matchStartTime,matchEndTime:window.kartStats.matchEndTime,isSpecialMode:t,isCustomMode:a,joined:window.kartStats.joined,started:window.kartStats.started,quit:window.kartStats.quit,killTimestamps:window.kartStats.killTimestamps,deathTimestamps:window.kartStats.deathTimestamps};console.log("[SKMT][DEBUG] Posting match complete:",i),window.postMessage({type:"SKMT_MATCH_COMPLETE",data:i},"*"),resetStats(),window.kartStats.awaitingStartType=!0,console.log("[SKMT][DEBUG] Game end/exit handler completed posting message and resetting state.")}window.kartStats.awaitingStartType&&e.includes("bytebrew: sending custom event: start_game")&&(window.kartStats.isSpecialMode||window.kartStats.isCustomMode||(window.kartStats.isSpecialMode=!1),window.kartStats.kills=0,window.kartStats.deaths=0,window.kartStats.matchActive=!0,window.kartStats.matchStartTime=Date.now(),window.kartStats.started=!0,window.kartStats.joined=!1,window.kartStats.quit=!1,window.kartStats.awaitingStartType=!1),window.kartStats.matchActive&&(e.includes("destroyed_human")&&(window.kartStats.kills++,window.kartStats.killTimestamps.push(Date.now())),(e.includes("destroyed_by_human")||e.includes("destroyed_by_bot"))&&(window.kartStats.deaths++,window.kartStats.deathTimestamps.push(Date.now())))}e.apply(console,t)}}function resetStats(){window.kartStats.kills=0,window.kartStats.deaths=0,window.kartStats.matchActive=!1,window.kartStats.matchStartTime=null,window.kartStats.matchEndTime=null,window.kartStats.joined=!1,window.kartStats.started=!1,window.kartStats.quit=!1,window.kartStats._pendingGameEnd=!1,window.kartStats._successLogCount=0,window.kartStats.killTimestamps=[],window.kartStats.deathTimestamps=[],window.kartStats._gameEndTimeout&&clearTimeout(window.kartStats._gameEndTimeout),window.kartStats._gameEndTimeout=null}window.kartStats={kills:0,deaths:0,matchActive:!1,matchStartTime:null,matchEndTime:null,isSpecialMode:!1,isCustomMode:!1,joined:!1,started:!1,quit:!1,awaitingStartType:!0,_pendingGameEnd:!1,_successLogCount:0,_gameEndTimeout:null,skid:null,killTimestamps:[],deathTimestamps:[]},console.log=interceptConsole("log",originalLog),console.info=interceptConsole("info",originalInfo),console.warn=interceptConsole("warn",originalWarn),console.error=interceptConsole("error",originalError);