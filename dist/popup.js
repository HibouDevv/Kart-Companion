(()=>{function e(e){return e?new Date(e).toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",year:"2-digit",month:"2-digit",day:"2-digit"}):"-"}function t(e,t){return 0===t?e>0?e.toFixed(2):"0.00":(e/t).toFixed(2)}document.getElementById("kills"),document.getElementById("deaths"),document.getElementById("matches"),document.getElementById("matches-list");let n=null,o="normal";function s(e,t){return`${e}_${t}_${o}`}function d(){document.getElementById("normalModeBtn").classList.toggle("selected","normal"===o),document.getElementById("specialModeBtn").classList.toggle("selected","special"===o),document.getElementById("customModeBtn").classList.toggle("selected","custom"===o)}function a(){chrome.storage.sync.get(["currentSkid"],(d=>{n=d.currentSkid||"Default",document.getElementById("skidValue").textContent=n;const c=[s("matchHistory",n),s("gamesJoined",n),s("gamesStarted",n),s("gamesQuit",n),s("matchesCompleted",n)];console.log("[SKMT][LOAD] Loading stats for SKID:",n,"Mode:",o,"Keys:",c),chrome.storage.sync.get(c,(d=>{console.log("[SKMT][LOAD] Data returned from chrome.storage.sync:",d);const c=d[s("matchHistory",n)]||[];let m=0,i=0;c.forEach((e=>{m+=e.kills||0,i+=e.deaths||0})),document.getElementById("kills").textContent=m,document.getElementById("deaths").textContent=i,document.getElementById("kdr").textContent=t(m,i),document.getElementById("gamesJoined").textContent=d[s("gamesJoined",n)]||0,document.getElementById("gamesStarted").textContent=d[s("gamesStarted",n)]||0,document.getElementById("gamesQuit").textContent=d[s("gamesQuit",n)]||0,document.getElementById("matchesCompleted").textContent=d[s("matchesCompleted",n)]||0;const l=document.getElementById("matches-list");l.innerHTML="",c.slice().reverse().forEach(((n,d)=>{const m=document.createElement("div");m.className="match-card";const i=document.createElement("div");i.className="match-card-content";const r=document.createElement("div");r.className="match-meta",r.textContent=`#${c.length-d} | ${e(n.matchStartTime)} - ${e(n.matchEndTime)}`,i.appendChild(r);const u=document.createElement("div");u.className="match-stats",u.innerHTML=`Kills: <b>${n.kills}</b> &nbsp; Deaths: <b>${n.deaths}</b> &nbsp; KDR: <b>${t(n.kills,n.deaths)}</b>`,i.appendChild(u);const g=document.createElement("div");g.className="match-flags";let h=[];n.joined&&h.push("Joined"),n.started&&h.push("Started"),n.quit&&h.push("Quit"),n.isSpecialMode&&h.push("Special Mode"),n.isCustomMode&&h.push("Custom Match"),h.length>0&&(g.textContent=h.join(" | ")),i.appendChild(g);const y=document.createElement("button");y.className="trash-btn",y.title="Delete this match",y.innerHTML='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 8V15M10 8V15M14 8V15M3 5H17M8 5V3H12V5M5 5V17C5 17.5523 5.44772 18 6 18H14C14.5523 18 15 17.5523 15 17V5" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',y.onclick=()=>{return e=c.length-1-d,void chrome.storage.sync.get(["currentSkid"],(t=>{const n=t.currentSkid||"Default",d=s("matchHistory",n);chrome.storage.sync.get([d],(t=>{let c=t[d]||[];if(e<0||e>=c.length)return;c.splice(e,1)[0];let m=0,i=0,l=0,r=0,u=0,g=0;c.forEach((e=>{m+=e.kills||0,i+=e.deaths||0,e.joined&&l++,e.started&&r++,e.quit&&u++,"special"===o&&e.isSpecialMode&&!e.quit&&g++,"normal"!==o||e.isSpecialMode||e.quit||g++,"custom"===o&&e.isCustomMode&&!e.quit&&g++}));const h={};h[s("matchHistory",n)]=c,h[s("gamesJoined",n)]=l,h[s("gamesStarted",n)]=r,h[s("gamesQuit",n)]=u,h[s("matchesCompleted",n)]=g,chrome.storage.sync.set(h,a)}))}));var e},m.appendChild(i),m.appendChild(y),l.appendChild(m)}))}))}))}document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("normalModeBtn").addEventListener("click",(()=>{o="normal",d(),a()})),document.getElementById("specialModeBtn").addEventListener("click",(()=>{o="special",d(),a()})),document.getElementById("customModeBtn").addEventListener("click",(()=>{o="custom",d(),a()})),d(),a()})),chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&a()})),document.getElementById("resetStatsBtn").addEventListener("click",(function(){if(n&&confirm("Are you sure you want to reset all stats and match history for this SKID and mode?")){const e={};e[s("matchHistory",n)]=[],e[s("gamesJoined",n)]=0,e[s("gamesStarted",n)]=0,e[s("gamesQuit",n)]=0,e[s("matchesCompleted",n)]=0,chrome.storage.sync.set(e,a)}})),window.addEventListener("message",(function(e){e.data&&"SKMT_SKID_UPDATED"===e.data.type&&a()}))})();