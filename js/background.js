(()=>{const e={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID};let t=null;try{firebase.initializeApp(e),t=firebase.firestore()}catch(e){console.error("Error initializing Firebase:",e)}chrome.runtime.onMessage.addListener(((e,s,r)=>{if("matchComplete"===e.type)!async function(e){if(t)try{if(e.isSpecialMode){const s=t.collection("special_matches").doc();await s.set({...e,timestamp:firebase.firestore.FieldValue.serverTimestamp()})}else{const s=t.collection("matches").doc();await s.set({...e,timestamp:firebase.firestore.FieldValue.serverTimestamp()}),await async function(e){if(t)try{const s=t.collection("players").doc(e.skid),r=await s.get(),a=r.exists?r.data():{totalMatches:0,totalKills:0,totalDeaths:0,totalPowerUpsCollected:0,totalPowerUpsUsed:0,bestSmashStreak:0,specialModeMatches:0},o={totalMatches:a.totalMatches+1,totalKills:a.totalKills+e.kills,totalDeaths:a.totalDeaths+e.deaths,totalPowerUpsCollected:a.totalPowerUpsCollected+e.powerUpsCollected,totalPowerUpsUsed:a.totalPowerUpsUsed+e.powerUpsUsed,bestSmashStreak:Math.max(a.bestSmashStreak,Math.max(...e.smashStreaks.map((e=>e.type))))};await s.set(o,{merge:!0})}catch(e){console.error("Error updating player stats:",e)}}(e.playerStats)}}catch(e){console.error("Error storing match data:",e)}}(e.data);else if("OPEN_VISUALIZERS"===e.type){console.log("[SKMT] Opening visualizers page");try{const e=chrome.runtime.getURL("visualizers.html");return console.log("[SKMT] Visualizers URL:",e),chrome.tabs.create({url:e,active:!0},(e=>{chrome.runtime.lastError?(console.error("[SKMT] Error creating tab:",chrome.runtime.lastError),r({success:!1,error:chrome.runtime.lastError.message})):(console.log("[SKMT] Visualizers page opened successfully in tab:",e.id),r({success:!0,tabId:e.id}))})),!0}catch(e){return console.error("[SKMT] Error in OPEN_VISUALIZERS handler:",e),r({success:!1,error:e.message}),!1}}})),chrome.runtime.onInstalled.addListener((()=>{chrome.storage.local.set({settings:{enableTracking:!0,showNotifications:!0}})})),chrome.runtime.onUpdateAvailable.addListener((()=>{chrome.runtime.reload()}))})();